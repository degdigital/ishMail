/*!
 * URL Handler - v0.1
 *
 * Copyright (c) 2013 Dave Olsen, http://dmolsen.com
 * Licensed under the MIT license
 *
 * Helps handle the initial iFrame source. Parses a string to see if it matches
 * an expected pattern in Pattern Lab. Supports Pattern Labs fuzzy pattern partial
 * matching style.
 *
 */
var urlHandler={skipBack:!1,targetOrigin:"file:"==window.location.protocol?"*":window.location.protocol+"//"+window.location.host,getFileName:function(t){var e="patterns",n="";if(void 0==t)return n;if("all"==t)return"styleguide/html/styleguide.html";var a=-1!=t.indexOf("viewall-")?viewAllPaths:patternPaths;nameClean=t.replace("viewall-","");var l=this.getPatternInfo(nameClean,a),i=l[0],r=l[1];if(void 0!=a[i]&&void 0!=a[i][r])n=a[i][r];else if(void 0!=a[i])for(patternMatchKey in a[i])if(-1!=patternMatchKey.indexOf(r)){n=a[i][patternMatchKey];break}if(""==n)return n;var o=/\//g;return-1!=t.indexOf("viewall-")&&""!=n?n=e+"/"+n.replace(o,"-")+"/index.html":""!=n&&(n=e+"/"+n.replace(o,"-")+"/"+n.replace(o,"-")+".html"),n},getPatternInfo:function(t,e){for(var n=t.split("-"),a=1,l=n.length,i=n[0];void 0==e[i]&&l>a;)i+="-"+n[a],a++;return pattern=t.slice(i.length+1,t.length),[i,pattern]},getRequestVars:function(){var t=new function(t){if(t.length>1)for(var e,n=0,a=t.substr(1).split("&");n<a.length;n++)e=a[n].split("="),this[unescape(e[0])]=e.length>1?unescape(e[1]):""}(window.location.search);return t},pushPattern:function(t,e){var n={pattern:t},a=urlHandler.getFileName(t),l=window.location.protocol+"//"+window.location.host+window.location.pathname.replace("public/index.html","public/")+a;if(e!=l)document.getElementById("sg-viewport").contentWindow.postMessage({path:a},urlHandler.targetOrigin);else{var i="file:"==window.location.protocol?null:window.location.protocol+"//"+window.location.host+window.location.pathname.replace("index.html","")+"?p="+t;history.pushState(n,null,i),document.getElementById("title").innerHTML="Pattern Lab - "+t,document.getElementById("sg-raw").setAttribute("href",urlHandler.getFileName(t))}},popPattern:function(t){var e=t.state;if(null==e)return this.skipBack=!1,void 0;if(null!=e)var n=e.pattern;var a="";a=this.getFileName(n),""==a&&(a="styleguide/html/styleguide.html"),document.getElementById("sg-viewport").contentWindow.postMessage({path:a},urlHandler.targetOrigin),document.getElementById("title").innerHTML="Pattern Lab - "+n,document.getElementById("sg-raw").setAttribute("href",urlHandler.getFileName(n)),wsnConnected&&wsn.send('{"url": "'+a+'", "patternpartial": "'+n+'" }')}};window.onpopstate=function(t){urlHandler.skipBack=!0,urlHandler.popPattern(t)};